/*
 * JSquares2 for jQuery
 * 
 * http://roubenmeschian.com
 * 
 * Dual licensed under the MIT and GPL licenses.
 *
 * Version: 1.0
 * 
 * Fork of jSquares - http://boedesign.com/blog/2009/10/22/jsquares-for-jquery/
 *
 */
(function(a){a.extend(a.easing,{easeOutBack:function(a,b,c,d,e,f){if(f==undefined)f=1.70158;return d*((b=b/e-1)*b*((f+1)*b+f)+1)+c}});a.fn.jsquares2=a.fn.jSquares2=function(b){var c={smallImg:".js-small-image",image:".js-image",caption_width:668,caption_delay:20,fade_to:.5,fade_start:1,fade_on_hover:true,caption_animate:true,caption_animate_time:300,caption_animate_easing:"easeOutBack",_overlay_selector_class:"js-caption-overlay"};b=a.extend(c,b);var d,e=this,f=[],g;var h=function(a,b){if(b===undefined)b=130;f.push(a);if(g)window.clearTimeout(g);g=window.setTimeout(function(){var a=f.pop();f=new Array;a()},b)};var i=function(a,c){var f=a||d;h(function(){if(!f)return;f.remove();if(d&&d[0]===f[0])d=null;h(function(){if(b.fade_on_hover)e.find(b.smallImg).fadeTo(10,b.fade_start)},0)})};e.mousemove(function(){i()});e.find(b.image).mousemove(function(){return false});e.find(b.image).mouseenter(function(){var c=this;var f=a(c);h(function(){if(d&&d!==undefined){if(d.js2T===c)return;d.remove()}var g=f.find(".js-overlay-caption-content").html();var j=f.find(".js-small-image").attr("src");var k=new Image;k.onload=function(){var k=f.offset();var l=f.height();var m=f.width();var n=e.offset().left+e.width()/2;var o=k.left<n;var p=14;var q=b.caption_width;var r=b.caption_animate?b.caption_width*2/3:q;var s=this.height;var t=this.width;var u=q/2;var v=Math.ceil(s*(u/t));var w=k.top-p;d=o?a("<div style='height: "+v+"px'><div style='position: relative'>            <div style='position: absolute; top: 0; left: 0; line-height: 0'><img src='"+j+"' style='width: "+u+"px' /></div>                   <div class='jsquares2CaptionTxt' style='display: none; position: absolute; top: 0; right: 0; left: "+(u+10)+"px'>"+g+"</div>                   </div></div>"):a("<div style='height: "+v+"px'><div style='position: relative'>  <div class='jsquares2CaptionTxt' style='display: none; position: absolute; top: 0; left: 0; right: "+(u+10)+"px'>"+g+"</div> <div style='position: absolute; top: 0; right: 0; line-height: 0'><img src='"+j+"' style='width: "+u+"px' /></div>       </div></div>");d.js2T=c;d.mouseleave(function(){i(d,c)});d.mouseenter(function(){h(function(){})});d.css("top",w).css("width",r).addClass(b._overlay_selector_class);if(o){d.css("left",k.left-p)}else{d.css("right",a(document).width()-(k.left+m+p))}a("body").append(d);var x=function(){d.find(".jsquares2CaptionTxt").fadeIn(60)};if(b.caption_animate){d.animate({width:q},b.caption_animate_time,b.caption_animate_easing,x)}else{x()}if(b.fade_on_hover)e.find(b.smallImg).css("opacity",b.fade_to)};k.src=j},b.caption_delay)});return this}})(jQuery)